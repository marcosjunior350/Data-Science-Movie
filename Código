import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

df = pd.read_excel("Dados_Filmes.xlsx")

## AnÃ¡lise ExploratÃ³ria dos dados (EDA)

# Ver dimensÃµes do dataset
print("DimensÃµes do dataset:", df.shape)

# Verificar valores ausentes
print("\nValores ausentes por coluna:")
print(df.isnull().sum())

# Contar gÃªneros (separados por '|')
genre_series = df['GÃªneros'].dropna().str.split('|').explode()
genre_counts = genre_series.value_counts()

print("\nGÃªneros mais frequentes:")
print(genre_counts)

# Verificar filmes com gÃªnero ou tÃ­tulo ausente
missing_genres = df[df['GÃªneros'].isnull()]
missing_titles = df[df['TÃ­tulo'].isnull()]

print(f"\nFilmes com gÃªnero ausente: {len(missing_genres)}")
print(f"Filmes com tÃ­tulo ausente: {len(missing_titles)}")

# Verificar tÃ­tulos duplicados
duplicate_titles = df[df.duplicated(subset='TÃ­tulo', keep=False)]
print(f"TÃ­tulos duplicados encontrados: {len(duplicate_titles)}")

# Ver gÃªneros Ãºnicos
unique_genres = genre_series.unique()
print("\nGÃªneros Ãºnicos encontrados:")
print(unique_genres)

# GrÃ¡fico de barras dos gÃªneros
genre_df = genre_counts.reset_index()
genre_df.columns = ['GÃªnero', 'Contagem']

# Plotar grÃ¡fico
plt.figure(figsize=(12,6))
sns.barplot(data=genre_df, x='GÃªnero', y='Contagem', hue='GÃªnero', palette='viridis', legend=False)
plt.xticks(rotation=45)
plt.title('DistribuiÃ§Ã£o dos GÃªneros de Filmes')
plt.xlabel('GÃªnero')
plt.ylabel('Quantidade de Filmes')
plt.tight_layout()
plt.show()

## 2. PrÃ©-processamento dos Dados (One-Hot Encoding)

# Remover a linha com tÃ­tulo ausente
df_clean = df.dropna(subset=["TÃ­tulo"])

# Aplicar One-Hot Encoding nos gÃªneros (separados por "|")
genre_dummies = df_clean['GÃªneros'].str.get_dummies(sep='|')

# Concatenar com as colunas de identificaÃ§Ã£o
df_preprocessed = pd.concat([df_clean[['Filme', 'TÃ­tulo']], genre_dummies], axis=1)

# Visualizar as primeiras linhas da base tratada
print(df_preprocessed.head())

## 3. RecomendaÃ§Ã£o Baseada em ConteÃºdo (Similaridade de GÃªneros)

from sklearn.metrics.pairwise import cosine_similarity

# CÃ³pia da base tratada para trabalhar
df_features = df_preprocessed.drop(columns=['Filme'])

# Calcula a matriz de similaridade entre os filmes
similarity_matrix = cosine_similarity(df_features.drop(columns=['TÃ­tulo']))

# Cria uma funÃ§Ã£o para recomendar filmes
def recomendar_filmes(titulo_filme, df=df_features, similarity=similarity_matrix, n=10):
    # Verifica se o tÃ­tulo existe
    if titulo_filme not in df['TÃ­tulo'].values:
        print("Filme nÃ£o encontrado.")
        return

    # Ãndice do filme informado
    idx = df[df['TÃ­tulo'] == titulo_filme].index[0]

    # Pega as similaridades da linha correspondente
    similaridades = list(enumerate(similarity[idx]))

    # Ordena pelas maiores similaridades (exceto ele mesmo)
    similaridades = sorted(similaridades, key=lambda x: x[1], reverse=True)[1:n+1]

    # Pega os Ã­ndices dos filmes recomendados
    filmes_recomendados = [df.iloc[i[0]]['TÃ­tulo'] for i in similaridades]

    print(f"\nğŸ¬ Filmes semelhantes a: **{titulo_filme}**\n")
    for i, filme in enumerate(filmes_recomendados, 1):
        print(f"{i}. {filme}")

# Exemplo de uso:
recomendar_filmes("Space Jam (1996)", n=15)
